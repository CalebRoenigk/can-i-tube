<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Can I Tube?</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="assets/font/font.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#1d1d1d">
    <meta name="apple-mobile-web-app-title" content="Can I Tube">
    <meta name="application-name" content="Can I Tube">
    <meta name="msapplication-TileColor" content="#e6e6e6">
    <meta name="theme-color" content="#e6e6e6">
  </head>
  <body class="bkgd-neutral">
    <div id="river-loader-wrapper">
      <div class="container">
        <div id="river-load-title"></div>
      </div>
    </div>
    <div id="border-line">
      <div class="container">
        <div class="border-content content-neutral" id="left-border-content" style="width: 0px; padding: 0px; opacity: 0;">
          <div class="container">
            <div class="content-mask">
              <div class="container">
              </div>
            </div>
          </div>
        </div>
        <div class="border-content content-neutral" id="right-border-content" style="width: 0px; padding: 0px; opacity: 0;">
          <div class="container">
            <div class="content-mask">
              <div class="container">
                Loading 100%
              </div>
            </div>
          </div>
        </div>
        <div class="border-content content-neutral" id="bottom-border-content">
          <div class="container">
            <div class="content-mask">
              <div class="container">
                Check Now
              </div>
            </div>
          </div>
        </div>
        <div id="border-stroke"></div>
        <div id="inner-fill-content">
          <div class="container">
            <div id="fill-title-text"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="subtitle-text-wrapper">
      <div class="container">
        <div class="subtitle" id="subtitle-top">Is The</div>
        <div class="subtitle" id="subtitle-bottom">Safe Today?</div>
      </div>
    </div>
    <div id="river-menu-wrapper" data-open="false" style="height: 58px;">
      <div class="container" style="transform: translateY(-116px);">
        <div class="select-menu" id="river-select" style="transform: translateY(-116px);">
          <select name="rivers" id="river-selector">
            <option value="Cape Fear River" data-state="NC" data-subtitle="The">Cape Fear River</option>
            <option value="Catawba River" data-state="NC" data-subtitle="The">Catawba River</option>
            <option value="Congaree River" data-state="SC" data-subtitle="The">Congaree River</option>
            <option value="Dan River" data-state="NC" data-subtitle="The">Dan River</option>
            <option value="none" data-state="null" data-subtitle="">Select A River</option>
            <option value="French Broad" data-state="NC" data-subtitle="The">French Broad</option>
            <option value="New River" data-state="NC" data-subtitle="The">New River</option>
            <option value="Saluda River" data-state="SC" data-subtitle="The">Saluda River</option>
          </select>
          <div class="select-menu-items"></div>
          <div class="select-menu-selected" data-list-item="0"></div>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript">
    // Log the current version
    console.log('Can I Tube v1.6.0');

    // This object holds all the river info for each selectable river
    var riverInfo = {
      "cape-fear-river": {
        "siteID": "02102500",
        "state": "NC",
        "safe_range": {
          "min": 400,
          "max": 1000
        }
      },
      "catawba-river": {
        "siteID": "02145000",
        "state": "NC",
        "safe_range": {
          "min": 2500,
          "max": 3600
        }
      },
      "congaree-river": {
        "siteID": "02169500",
        "state": "SC",
        "safe_range": {
          "min": 1000,
          "max": 4000
        }
      },
      "dan-river": {
        "siteID": "02071000",
        "state": "NC",
        "safe_range": {
          "min": 250,
          "max": 800
        }
      },
      "french-broad": {
        "siteID": "03451500",
        "state": "NC",
        "safe_range": {
          "min": 500,
          "max": 2900
        }
      },
      "new-river": {
        "siteID": "03161000",
        "state": "NC",
        "safe_range": {
          "min": 400,
          "max": 1000
        }
      },
      "saluda-river": {
        "siteID": "02167000",
        "state": "SC",
        "safe_range": {
          "min": 600,
          "max": 1100
        }
      }
    }

    // Set the border-line box width and height when the page is ready
    $(document).ready(function() {
      $('#border-line').width($('#river-menu-wrapper').width()+20);
      $('#border-line').height($('#subtitle-text-wrapper').height()+20);
    })

    // Create the selection options from the select options for each dropdown
    $('.select-menu').each(function() {
      var currentSelectMenu = $(this).attr('id');

      // For each select menu
      $('#' + currentSelectMenu + ' > select > option').each(function(i) {
        // For each selection menu option, add a selection div
        var clickFunction = "setSelection('" + $(this).val().replace(/\s/g, '-').toLowerCase() + "', '" + currentSelectMenu.toString() + "', '" + i + "')";
        var currentOption = '<div id="' + $(this).val().replace(/\s/g, '-').toLowerCase() + '" data-state="' + $(this).attr('data-state') + '" data-list-index="' + i + '" data-subtitle="' + $(this).attr('data-subtitle') + '" onClick="' + clickFunction + '">' + $(this).text() + '</div>';
        $('#' + currentSelectMenu + ' > .select-menu-items').append(currentOption);
      });

      // Set the default selection of the menu to the first item
      setSelection('none', currentSelectMenu, 4);
    });

    // This function sets the selection of a dropdown menu based on a triggered user click
    function setSelection(selectionID, menuID, listIndex) {
      var singleOptionHeight = $('#river-select > .select-menu-items > div').outerHeight(true);

      // For each select option, remove the same-as-selected class
      $('#' + menuID + ' > .select-menu-items > div').each(function() {
        $(this).removeClass('same-as-selected');
      });

      // Add the same-as selected class to the selected option
      $('#' + selectionID).addClass('same-as-selected');

      // Store where we currently are
      var previousListItem = $('#' + menuID + ' > .select-menu-selected').attr('data-list-item');
      // Set the list-item to the new item value
      $('#' + menuID + ' > .select-menu-selected').attr('data-list-item', listIndex);

      // Calculate the value to translate the list
      var translateY = clampValue(-singleOptionHeight*(listIndex-2), -(singleOptionHeight*3), 0);
      $('#' + menuID).css('transform', 'translateY(' + translateY + 'px)');
    }

    // This function clamps a provided number within a range
    function clampValue(number, min, max) {
      if(number < min) {
        return min;
      } else if(number > max) {
        return max;
      } else {
        return number;
      }
    }

    // When the user clicks any list item
    $('#river-select > .select-menu-items > div').click(function() {
      // If the dropdown menu is not open, open it
      if($('#river-menu-wrapper').attr('data-open') !== true) {
        // Darken the background color
        $('body').css('background-color', "#D8D8D8");
        // Darken the border-content
        $('.content-neutral').css('background-color', "#D8D8D8");
        // Remove any balance offset on the interior container
        $('#river-menu-wrapper > .container').css('transform', 'translateY(' + 0 + 'px)');
        // Tag the menu as open
        $('#river-menu-wrapper').attr('data-open', true);
        // Set the height of the river menu wrapper to the value of 5 options
        var singleOptionHeight = $('#river-select > .select-menu-items > div').outerHeight(true);
        // Set the height of the river menu wrapper
        $('#river-menu-wrapper').height(singleOptionHeight*5);
      }
    });

    // If the user clicks outside of the menu when its open then close the menu
    $(document).click(function (e) {
      if ($(e.target).closest("#river-menu-wrapper").length === 0) {
        var singleOptionHeight = $('#river-select > .select-menu-items > div').outerHeight(true);
        // Tag the menu as closed
        $('#river-menu-wrapper').attr('data-open', false);
        // Close the menu
        $('#river-menu-wrapper').height(singleOptionHeight);
        // Reset the background color
        $('body').css('background-color', "");
        // Reset the border-content color
        $('.content-neutral').css('background-color', "");
        // Offset the interior container by the correct amount to lost size
        if($('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') > 1 && $('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') < $('#river-menu-wrapper > .container > #river-select > .select-menu-items').children().length - 2) {
          // Standard list
          $('#river-menu-wrapper > .container').css('transform', 'translateY(' + -singleOptionHeight*2 + 'px)');
        } else if($('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') == 1) {
          $('#river-menu-wrapper > .container').css('transform', 'translateY(' + -singleOptionHeight + 'px)');
        } else if($('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') == 0) {
          $('#river-menu-wrapper > .container').css('transform', 'translateY(' + 0 + 'px)');
        } else if($('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') == $('#river-menu-wrapper > .container > #river-select > .select-menu-items').children().length - 2) {
          $('#river-menu-wrapper > .container').css('transform', 'translateY(' + -singleOptionHeight*3 + 'px)');
        } else if($('#river-menu-wrapper > .container > #river-select > .select-menu-selected').attr('data-list-item') == $('#river-menu-wrapper > .container > #river-select > .select-menu-items').children().length-1) {
          $('#river-menu-wrapper > .container').css('transform', 'translateY(' + -singleOptionHeight*4 + 'px)');
        }

        // If a river is selected, bring in the CTA and border-line
        if($('.same-as-selected').attr('data-state') !== 'null') {
          $('#border-line').css('opacity', '1');
          // Only update the subtitle text if the selection menu still exists
          if($('#river-menu-wrapper').length) {
            $('#bottom-border-content > .container > .content-mask > .container').css('transform', 'translateX(0%) translateY(0%)');
            $('#subtitle-top').text("Is " + $('.same-as-selected').attr('data-subtitle'));
            $('.subtitle').css('opacity', '1');
          }
        } else {
          $('#border-line').css('opacity', '');
          // Only update the subtitle text if the selection menu still exists
          if($('#river-menu-wrapper').length) {
            $('#subtitle-top').text("Is " + $('.same-as-selected').attr('data-subtitle'));
            $('#bottom-border-content > .container > .content-mask > .container').css('transform', '');
            $('.subtitle').css('opacity', '');
          }
        }
      }
    });

    // When the user clicks on Check Now
    $('#bottom-border-content').click(async function() {
      // Gather the selected river data
      var selectionData = {
        'title': $('.same-as-selected').text(),
        'id': $('.same-as-selected').attr('id'),
        'state': $('.same-as-selected').attr('data-state')
      }

      // Populate the selected river into the loading title
      $('#river-load-title').attr('data-text', selectionData.title).text(selectionData.title).attr('data-state', selectionData.state).attr('data-name', selectionData.id);

      // Delete the selection menu
      $('#river-menu-wrapper').remove();

      // Remove Check Now and revoke its pointer-events
      $('#bottom-border-content').css('pointer-events', 'none').css('transition', 'all .375s cubic-bezier(.5,0,.25,1)').css('transform', 'translate(-50%, 50%) scaleX(0)');
      $('#bottom-border-content > .container > .content-mask > .container').css('transform', 'translateX(0%) translateY(150%) scaleX(2.25)');

      // Set the border-line transformation
      $('#border-line').attr('style', 'width: 75vw; height: 75vh; transition-duration: .625s;');

      // Add the River Title text to the fill mask title
      $('#fill-title-text').empty().text(selectionData.title);

      // Bring in the side content
      // Left
      // Populate with the current date
      var dateNow = new Date();
      var dateFormatter = new Intl.DateTimeFormat('en-us', {
        day: 'numeric',
        month: 'short',
      });
      $('#left-border-content > .container > .content-mask > .container').text(dateFormatter.format(dateNow));
      $('#left-border-content').css('width', '').css('padding', '').css('opacity', '').css('transition', 'all .375s cubic-bezier(.5,0,.25,1)');
      $('#left-border-content > .container > .content-mask > .container').css('transform', 'translateX(0%) translateY(0%)');
      // Right
      $('#right-border-content').css('width', '').css('padding', '').css('opacity', '').css('transition', 'all .375s cubic-bezier(.5,0,.25,1)');
      $('#right-border-content > .container > .content-mask > .container').css('transform', 'translateX(0%) translateY(0%)');

      // Restyle the title content
      $('#river-load-title').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)').css('letter-spacing', '16px').css('font-size', '96px');
      $('#fill-title-text').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)').css('letter-spacing', '16px').css('font-size', '96px');

      // Restyle the subtitle content
      $('#subtitle-text-wrapper').width('500px').height('350px').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)');
      // Subtitle Text
      $('.subtitle').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)').css('font-size', '32px');
      // Top
      $('#subtitle-top').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)').css('top', '28%');
      // Bottom
      $('#subtitle-bottom').css('transition', 'all .625s cubic-bezier(.625,0,.25,1)').css('bottom', '20%');

      // Generate the loading styles
      var loadTime = 5000;
      generateLoadFrames(loadTime);

      // Add the loading class to the loading text
      $('#river-load-title').addClass('load-bar');
      $('#right-border-content > .container > .content-mask > .container').addClass('text-load');

      // Wait for the current condition data to come in, then finish the loading bar
      var selectedRiver = $('#river-load-title').attr('data-name');
      var siteCode = riverInfo[selectedRiver].siteID;
      // Name of the real-time cookie for the current site
      var currentSiteCookieName = "canitube_" + selectedRiver + "_currentData";

      // Fetch the current site real-time data
      var realTimeFlowValue = await fetchRealTimeData(siteCode, currentSiteCookieName);

      // Finish the loading bar
      $('#river-load-title').removeClass('load-bar').addClass('load-bar-finish');
      $('#right-border-content > .container > .content-mask > .container').removeClass('text-load').addClass('text-load-finish');

      // Begin styling and transitioning the page
      var currentSafeRange = riverInfo[selectedRiver].safe_range;

      // Test if the current flow value is within the safe range
      if(realTimeFlowValue > (currentSafeRange.min - 1) && realTimeFlowValue < (currentSafeRange.max + 1)) {
        // Test if the average value is within a percentage of the safe range
        var rangeVariance = .25;
        var rangeSize = currentSafeRange.max - currentSafeRange.min;
        var superSafeRange = {
          "min": currentSafeRange.min + (rangeSize*(rangeVariance/2)),
          "max": currentSafeRange.max - (rangeSize*rangeVariance)
        };
        if(realTimeFlowValue > (superSafeRange.min - 1) && realTimeFlowValue < (superSafeRange.max + 1)) {
          // Today is safe
          console.log("Today is safe!");
          formatPage("YES", realTimeFlowValue, currentSafeRange);
        } else {
          // Today is maybe safe
          console.log("Today is maybe safe?");
          formatPage("MAYBE", realTimeFlowValue, currentSafeRange);
        }
      } else {
        // Today is not safe
        console.log("Today is not safe!");
        formatPage("NO", realTimeFlowValue, currentSafeRange);
      }
    });

    // This function places the @keyframes animation for the loader bar and loader text in a style element within the head of the page
    function generateLoadFrames(time) {
      var percentDone = 0;
      var timeLeft = time;
      var timeRange = {
        "max": 500,
        "min": 38
      };
      var ary = [];
      do {
        if(percentDone < 90) {
          var percentLeft = 100 - percentDone;
          var percentRandom = getRandomInt(percentLeft*.1, percentLeft/2);
          percentDone = percentDone + percentRandom;
          var transition = getRandomInt(timeRange.min, timeRange.max);
          timeLeft = timeLeft - transition;
          var delay = getRandomInt(timeLeft*.1, timeLeft/2);
          timeLeft = timeLeft - delay;

          ary.push(percentDone);
          ary.push(transition);
          ary.push(Math.abs(delay));
        } else {
          var transition = getRandomInt(timeRange.min, timeRange.max);
          var delay = timeLeft-transition;

          ary.push(100);
          ary.push(transition);
          ary.push(Math.abs(delay));
          percentDone = 100;
          timeLeft = 0;
        }
      } while (percentDone < 100);

      // This function returns a random integer between a min and max value
      function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }

      // This function generates a keyframe line based on input values
      function progressScale(scalePercent, previousScale, startTime, endTime, totalTime) {
        var easeChoice = getRandomInt(0,3);

        if(easeChoice == 0) {
          easeChoice = 'linear';
        }
        if(easeChoice == 1) {
          easeChoice = 'ease-in';
        }
        if(easeChoice == 2) {
          easeChoice = 'ease-out';
        }
        if(easeChoice == 3) {
          easeChoice = 'ease';
        }
        var stepStartPercent = Math.round((startTime/totalTime)*1000)/10;
        var stepEndPercent = Math.round((endTime/totalTime)*1000)/10;

        // If the scale percent is more than 96, change it to be only a few more than previous percent, this allows us to have an 'unfinished load bar'
        if(previousScale > 0) {
          previousScale = previousScale - 4;
        }
        if(scalePercent > 0) {
          if(scalePercent >= 97) {
            scalePercent = previousScale + 4;
          } else {
            scalePercent = scalePercent - 4;
          }
        }

        var stepStart = '\t' + stepStartPercent + '%    {clip-path: polygon(0% 0%, ' + previousScale + '% 0%, ' + previousScale + '% 100%, 0% 100%); animation-timing-function: ' + easeChoice + ';}';
        var stepEnd = '\t' + stepEndPercent + '%    {clip-path: polygon(0% 0%, ' + scalePercent + '% 0%, ' + scalePercent + '% 100%, 0% 100%); animation-timing-function: linear;}';
        var stepAll = [stepStart, stepEnd];
        return stepAll.join("\n");
      }

      // This function generates a keyframe line for text based on input values
      function progressText(scalePercent, previousScale, startTime, endTime, totalTime) {
        var easeChoice = getRandomInt(0,3);

        var stepStartPercent = Math.round((startTime/totalTime)*1000)/10;
        var stepEndPercent = Math.round((endTime/totalTime)*1000)/10;

        // If the scale percent is more than 96, change it to be only a few more than previous percent, this allows us to have an 'unfinished load bar'
        if(previousScale > 0) {
          previousScale = previousScale - 4;
        }
        if(scalePercent > 0) {
          if(scalePercent >= 97) {
            scalePercent = previousScale + 4;
          } else {
            scalePercent = scalePercent - 4;
          }
        }

        var stepStart = '\t' + stepStartPercent + '%    {content:"Loading ' + previousScale + '%";}';
        var stepEnd = '\t' + stepEndPercent + '%    {content:"Loading ' + scalePercent + '%";}';
        var stepAll = [stepStart, stepEnd];
        return stepAll.join("\n");
      }

      // Create the keyframes
      var openKeyframe = '@keyframes loadIn {';
      var closeKeyframe = '}';
      var keyframes = [openKeyframe];

      var openTextKeyframe = '@keyframes loadTextIn {';
      var closeTextKeyframe = '}';
      var textKeyframes = [openTextKeyframe];

      var elapsedTime = 0;
      var allTime = 0;

      // Add up the total amount of time
      for(var i=0; i < ary.length;) {
        allTime = allTime + ary[i+1] + ary[i+2];
        i = i+3;
      }

      for(var j=0; j < ary.length;) {
        if(j > 2) {
          var previousScale = ary[j-3];
        } else {
          var previousScale = 0;
        }
        var timeToStart = elapsedTime + ary[j+2];
        elapsedTime = elapsedTime + ary[j+1] + ary[j+2];
        var currentKeyframe = progressScale(ary[j], previousScale, timeToStart, elapsedTime, allTime);
        keyframes.push(currentKeyframe);

        var currentTextKeyframe = progressText(ary[j], previousScale, timeToStart, elapsedTime, allTime);
        textKeyframes.push(currentTextKeyframe);

        j = j+3;
      }

      keyframes.push(closeKeyframe);
      textKeyframes.push(closeTextKeyframe);

      // Create the bar class
      var barLoadClass = '.load-bar::after {\n\tanimation: loadIn ' + time/1000 + 's linear both;\n\tclip-path: polygon(0% 0%, 0% 0%, 0% 100%, 0% 100%);\n\tcolor: #1D1D1D;\n\tcontent: attr(data-text);\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\tz-index: -1;\n}';
      var barFinishLoadClass = '.load-bar-finish::after {\n\tclip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);\n\tcolor: #1D1D1D;\n\tcontent: attr(data-text);\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\tz-index: -1;\n}';

      // Create the loader text class
      var textLoadClass = '.text-load::after {\n\tposition: relative;\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tcontent: "Loading 0%";\n\twhite-space: nowrap;\n\tfont-family: "Kayak Sans Regular", arial, sans-serif;\n\tletter-spacing: 1px;\n\tfont-size: 16px;\n\tcolor: #1D1D1D;\n\ttext-align: center;\n\ttext-transform: uppercase;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\tanimation: loadTextIn ' + time/1000 + 's linear both;\n}';
      var textFinishLoadClass = '.text-load-finish::after {\n\tposition: relative;\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tcontent: "Loading 100%";\n\twhite-space: nowrap;\n\tfont-family: "Kayak Sans Regular", arial, sans-serif;\n\tletter-spacing: 1px;\n\tfont-size: 16px;\n\tcolor: #1D1D1D;\n\ttext-align: center;\n\ttext-transform: uppercase;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n}';

      $('head').append('<style type="text/css">\n' + keyframes.join('\n') + '\n' + textKeyframes.join('\n') + '\n' + barLoadClass + '\n' + barFinishLoadClass + '\n' + textLoadClass + '\n' + textFinishLoadClass + '\n</style>');
    }

    // This function fetches the current data
    function fetchRealTimeData(site, cookieName) {
      var dataCookiePresent = checkCookie(cookieName);

      if(dataCookiePresent == false) {
        return new Promise((resolve, reject) => {
          $.ajax({
            url: "https://waterservices.usgs.gov/nwis/iv/?format=json&sites=" + site + "&parameterCd=00060&siteStatus=active",
            dataType: 'JSON',
            data: '',
            success: function(json){
              console.log("Data Retreived!");
              // Here, convert the data to the app-ready format
              var appReadyData = parseRealTimeJSON(json);
              // Store the app-ready data in a cookie that expires in 1 hour
              var now = new Date();
              var time = now.getTime();
              time += 3600 * 1000;
              var expDate = now.setTime(time);
              // Write the cookie with the app-ready data
              writeCookie(cookieName, appReadyData, expDate);

              // Return the app-ready data
              resolve(parseInt(appReadyData));
             },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
               console.log("Error: AJAX request failed...");
               console.log(textStatus);
               console.log(errorThrown);
            }
          });
        })
      } else {
        // Note the non-expired data
        console.log("Data Already Present!");
        // Here, convert the data to the app-ready format
        var appReadyData = getCookie(cookieName);

        // Return the app-ready data
        return parseInt(appReadyData);
      }
    }

    // This function parses the real-time data json and returns app-ready data
    function parseRealTimeJSON(data) {
      var dataFlow = data.value.timeSeries[0].values[0].value[0].value;
      //var dataDataTime = data.value.timeSeries[0].values[0].value[0].dateTime;
      return dataFlow;
    }

    // This function writes a cookie ith a name, data, and a number of days before expiring
    function writeCookie(name, data, expire) {
      var now = new Date();
      now.setDate(now.getDate() + expire);
      var exp = now;
      document.cookie = name + "=" + data + ";" + "expires=" + exp.toUTCString() + ";";
    }

    // This function returns the data in a cookie of a specified name
    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    // This function checks for a cookie to see if it is present
    function checkCookie(name) {
      var cookieCheck = getCookie(name);
      if (cookieCheck == "") {
       return false;
      } else {
        if (cookieCheck !== "" && cookieCheck !== null) {
          return true;
        }
      }
    }

    // This function formats the page based on the determined safety
    function formatPage(state, currentFlowValue, safeRange) {
      // Clear all formatting
      $('body').removeClass("bkgd-neutral");
      $('#river-load-title').removeClass('load-bar-finish');
      $('.border-content').css('transition', 'all .375s ease');
      $('.border-content > .container > .content-mask > .container').css('transition', 'all .375s ease');

      // Begin the title transformation
      $('#river-loader-wrapper').css('top', '12.5vh');
      $('#river-load-title').css('transform', 'translate(0%, 25%)');
      $('#fill-title-text').css('top', '0').css('transform', 'translate(0%, 25%)');

      // Remove loading text
      $('#right-border-content > .container > .content-mask > .container').css('transform', 'translateX(-200%) translateY(0%)');
      $('#right-border-content').css('width', '0px').css('padding', '0');

      // Test for state
      if(state == "NO") {
        // No State
        $('body').addClass("bkgd-no");
        $('.content-neutral').addClass('content-no').removeClass('content-neutral');
        $('#border-stroke').css('border', '1px solid #EAC435');
        $('.text-stroke-neutral').addClass('text-stroke-no').removeClass('text-stroke-neutral');
        $('#river-load-title').css('color', '').css('-webkit-text-stroke-color', '#EAC435');
      }
      if(state == "MAYBE") {
        // Maybe State
        $('body').addClass("bkgd-maybe");
        $('.content-neutral').addClass('content-maybe').removeClass('content-neutral');
        $('#border-stroke').css('border', '1px solid #E4E6C3');
        $('.text-stroke-neutral').addClass('text-stroke-maybe').removeClass('text-stroke-neutral');
        $('#river-load-title').css('color', '').css('-webkit-text-stroke-color', '#E4E6C3');
      }
      if(state == "YES") {
        // Yes State
        $('body').addClass("bkgd-yes");
        $('.content-neutral').addClass('content-yes').removeClass('content-neutral');
        $('#border-stroke').css('border', '1px solid #261C15');
        $('.text-stroke-neutral').addClass('text-stroke-yes').removeClass('text-stroke-neutral');
        $('#river-load-title').css('color', '').css('-webkit-text-stroke-color', '#261C15');
      }
    }
  </script>
</html>
